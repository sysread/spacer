<!DOCTYPE html>
<html>
  <head>
      <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;">
      <meta name="format-detection" content="telephone=no">
      <meta name="msapplication-tap-highlight" content="no">
      <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">

      <link rel="stylesheet" type="text/css" href="css/vendor/bootstrap.min.css">
      <link rel="stylesheet" type="text/css" href="css/index.css">

      <script type="text/javascript" src="cordova.js"></script>
      <script type='application/javascript' src='js/vendor/fastclick.js'></script>
      <script type="text/javascript" src="js/vendor/jquery.min.js"></script>
      <script type="text/javascript" src="js/vendor/popper.min.js"></script>
      <script type="text/javascript" src="js/vendor/bootstrap.min.js"></script>
      <script type="text/javascript" src="js/vendor/solaris-model/dist/solaris-model.min.js"></script>

      <title>Spacer</title>
    </head>
  <body>
    <!-- Header -->
    <nav class="spacer-header fixed-top navbar navbar-dark px-3 py-2">
      <span class="navbar-text text-capitalize" id="spacer-location"></span>
      <span class="navbar-text" id="spacer-credits"></span>
      <span class="navbar-text" id="spacer-cargo"></span>
      <span class="navbar-text" id="spacer-fuel"></span>
      <span class="navbar-text" id="spacer-turn"></span>
    </nav>

    <!-- Content window -->
    <div id="spacer-content" class="container-fluid pt-3 pb-1 mt-5"></div>
    <div id="messages" class="container-fluid pt-3"></div>

    <!-- Navigation -->
    <nav id="spacer-navbar" data-toggle="collapse" data-target="#spacer-nav" class="fixed-bottom navbar navbar-dark navbar-expand-md border-danger border border-left-0 border-right-0 border-bottom-0">
      <a class="navbar-brand" href="#">Spacer</a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#spacer-nav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="spacer-nav" data-in-transit="0">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item py-2"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="summary"  data-path="summary.html"     class="nav-link active">Summary</a></li>
          <li class="nav-item py-2"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="work"     data-path="work.html"        class="nav-link">Work</a></li>
          <li class="nav-item py-2"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="docks"    data-path="commerce.html"    class="nav-link">Commerce</a></li>
          <li class="nav-item py-2"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="fabs"     data-path="fabricators.html" class="nav-link">Fabricators</a></li>
          <li class="nav-item py-2"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="shipyard" data-path="shipyard.html"    class="nav-link">Shipyard</a></li>
          <li class="nav-item py-2"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="nav"      data-path="navcomp.html"     class="nav-link">Navigation</a></li>
          <li class="nav-item py-2"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="status"   data-path="status.html"      class="nav-link">Status</a></li>
        </ul>
      </div>
    </nav>

    <!-- Libs -->
    <script type="text/javascript" src="js/physics.js"></script>
    <script type="text/javascript" src="js/data.js"></script>
    <script type="text/javascript" src="js/util.js"></script>
    <script type="text/javascript" src="js/transit.js"></script>
    <script type="text/javascript" src="js/system.js"></script>
    <script type="text/javascript" src="js/action.js"></script>
    <script type="text/javascript" src="js/agent/actor.js"></script>
    <script type="text/javascript" src="js/agent/crafter.js"></script>
    <script type="text/javascript" src="js/agent/hauler.js"></script>
    <script type="text/javascript" src="js/market.js"></script>
    <script type="text/javascript" src="js/place.js"></script>
    <script type="text/javascript" src="js/ship.js"></script>
    <script type="text/javascript" src="js/person.js"></script>
    <script type="text/javascript" src="js/navcomp.js"></script>
    <script type="text/javascript" src="js/ui.js"></script>
    <script type="text/javascript" src="js/game.js"></script>

    <!-- Main -->
    <script type="text/javascript">
      const game = new Game;

      function open(name) {
        let path = $(`#spacer-nav a[data-name='${name}']`).data('path') || name + '.html';
        if ($('#spacer-nav').data('in-transit')) return;
        $('#spacer-nav a').removeClass('active');
        $(`#spacer-nav a[data-name="${name}"]`).addClass('active');
        $('#spacer-content').empty().load(path);
        $('#spacer-nav').collapse('hide');
      }

      function clear_messages() {
        $('#messages .alert').fadeOut(function() {$(this).remove()});
      }

      function message(msg, type='info', clear_previous=false) {
        if (clear_previous) clear_messages();
        $('#messages').append(`<div class="alert alert-dismissable alert-${type} show fade">${msg}<button class="close" data-dismiss="alert">&times;</button></div>`);
      }

      function uniq(items, sep=' ') {
        if (!(items instanceof Array))
          items = `${str}`.split(sep).filter((s) => {return s != ''});
        let set = new Set(items);
        let arr = [];
        set.forEach((val) => {arr.push(val)});
        return arr.join(sep);
      }

      function csn(num) {
        let [integer, decimal] = `${num}`.split('.', 2);
        let three = new RegExp(/(\d{3})$/);
        let parts = [];

        while (three.test(integer))
          integer = integer.replace(three, (match) => {parts.unshift(match); return ''});

        if (integer)
          parts.unshift(integer);

        integer = parts.join(',');

        return decimal ? `${integer}.${decimal}` : integer;
      }

      function row(dt, dd) {
        return $('<div class="row py-2">')
          .append( $('<div class="col-sm b">').append(dt) )
          .append( $('<div class="col-sm mute">').append(dd) );
      }

      $(function() {
        $('#spacer-navbar').on('click', 'a', function(e) {
          e.preventDefault();
          e.stopPropagation();

          if ($(e.target).hasClass('nav-link')) {
            $('#messages').empty();
            $('#spacer-nav a').removeClass('active');
            $(e.target).addClass('active');
            open($(e.target).data('name'));
          }
        });

        //$(window).on('click', (e) => { $('#spacer-nav').collapse('hide')});
        //$('html').on('click', (e) => { $('#spacer-nav').collapse('hide')});

        FastClick.attach(document.body);
      });

      document.addEventListener("deviceready", onDeviceReady, false);

      function onDeviceReady() {
        if (StatusBar.isVisible)
          StatusBar.hide();
      }
    </script>
  </body>
</html>
