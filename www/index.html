<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">

    <link rel="stylesheet" type="text/css" href="css/vendor/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/index.css">

    <script src="cordova.js"></script>
    <script src='js/vendor/fastclick.js'></script>
    <script src="js/vendor/jquery.min.js"></script>
    <script src="js/vendor/bootstrap.bundle.min.js"></script>

    <!-- Libs -->
    <script data-main="js/loader" src="js/vendor/require.js"></script>

    <title>Spacer</title>
  </head>
  <body id="spacer">
    <!-- Header -->
    <nav id="spacer-status" class="spacer-header fixed-top navbar navbar-dark">
      <span class="navbar-text text-capitalize" id="spacer-location"></span>
      <span class="navbar-text" id="spacer-credits"></span>
      <span class="navbar-text" id="spacer-cargo"></span>
      <span class="navbar-text" id="spacer-fuel"></span>
      <span class="navbar-text" id="spacer-turn"></span>
    </nav>

    <!-- Content window -->
    <div id="content" />

    <script>
      require(
        [
          'vendor/vue',        // base framework
          'game',              // game state
          'component/global',  // global state
          'component/navbar',  // nav bar
          'component/content', // content div
        ],

        function(Vue, game) {
          const initial_page
            = game.turns == 0              ? 'newgame'
            : game.player.ship.isDestroyed ? 'newgame'
                                           : 'summary';

          const content_app = new Vue({
            el: '#content',

            data: {
              page: initial_page,
            },

            mounted() {
              this.override_page();
            },

            watch: {
              page() {
                this.override_page();
              },
            },

            computed: {
              nav_disabled() { return this.game.is_frozen },
            },

            methods: {
              override_page() {
                if (this.game.turns == 0) {
                  this.page = 'newgame';
                }
                else if (this.game.player.ship.isDestroyed) {
                  this.page = 'newgame';
                }
              },

              open(page) {
                if (this.game.is_frozen && page != 'newgame') {
                  return;
                }

                this.page = page;
              },
            },

            template: `
              <div>
                <Content @open="open" :page="page" />
                <NavBar  @open="open" :page="page" :disabled="nav_disabled" />
              </div>
            `,
          });
        },
      );
    </script>
  </body>
</html>
