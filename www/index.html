<!DOCTYPE html>
<html>
  <head>
      <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;">
      <meta name="format-detection" content="telephone=no">
      <meta name="msapplication-tap-highlight" content="no">
      <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">

      <link rel="stylesheet" type="text/css" href="css/vendor/bootstrap.min.css">
      <link rel="stylesheet" type="text/css" href="css/index.css">

      <script type="text/javascript" src="js/vendor/jquery.min.js"></script>
      <script type="text/javascript" src="js/vendor/popper.js"></script>
      <script type="text/javascript" src="js/vendor/bootstrap.min.js"></script>
      <script type="text/javascript" src="js/vendor/hammer.min.js"></script>

      <title>Spacer</title>
    </head>
  <body>
    <!-- Content window -->
    <div id="spacer-content" class="container-fluid pt-3 pb-1"></div>
    <div id="messages" class="container-fluid pt-3"></div>

    <!-- Navigation -->
    <nav id="spacer-navbar" data-toggle="collapse" data-target="#spacer-nav" class="fixed-bottom navbar navbar-dark navbar-expand-md border-danger border border-left-0 border-right-0 border-bottom-0">
      <a class="navbar-brand" href="#">
        <span class="pr-3">Spacer</span>
        <span class="navbar-text badge badge-pill font-weight-normal" id="spacer-turn"></span>
        <span class="navbar-text badge badge-pill font-weight-normal" id="spacer-credits"></span>
        <span class="navbar-text badge badge-pill font-weight-normal" id="spacer-cargo"></span>
      </a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#spacer-nav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="spacer-nav" data-in-transit="0">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="summary" data-path="summary.html" class="nav-link active">Summary</a></li>
          <li class="nav-item"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="wilds" data-path="wilds.html" class="nav-link">Wilderness</a></li>
          <li class="nav-item"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="docks" data-path="commerce.html" class="nav-link">Commerce</a></li>
          <li class="nav-item"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="fabs" data-path="fabricators.html" class="nav-link">Fabricators</a></li>
          <li class="nav-item"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="nav" data-path="navcomp.html" class="nav-link">NavComp</a></li>
          <li class="nav-item"><a href="#" data-toggle="collapse" data-target="#spacer-nav" data-name="status" data-path="status.html" class="nav-link active">Status</a></li>
        </ul>
      </div>
    </nav>

    <!-- Libs -->
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/vendor/solaris-model/dist/solaris-model.min.js"></script>

    <script type="text/javascript" src="js/data.js"></script>
    <script type="text/javascript" src="js/util.js"></script>
    <script type="text/javascript" src="js/system.js"></script>
    <script type="text/javascript" src="js/action.js"></script>
    <script type="text/javascript" src="js/agent.js"></script>
    <script type="text/javascript" src="js/market.js"></script>
    <script type="text/javascript" src="js/place.js"></script>
    <script type="text/javascript" src="js/ship.js"></script>
    <script type="text/javascript" src="js/person.js"></script>
    <script type="text/javascript" src="js/ui.js"></script>
    <script type="text/javascript" src="js/game.js"></script>

    <!-- Main -->
    <script type="text/javascript">
      function open(name) {
        if ($('#spacer-nav').data('in-transit'))
          return;
        $('#spacer-nav a').removeClass('active');
        $(`#spacer-nav a[data-name="${name}"]`).addClass('active');
        $('#spacer-content').empty().load($(`#spacer-nav a[data-name='${name}']`).data('path'));
        $('#spacer-nav').collapse('hide');
      }

      function clear_messages() {
        $('#messages .alert').fadeOut(function() {$(this).remove()});
      }

      function message(msg, type='info', clear_previous=false) {
        if (clear_previous) clear_messages();
        $('#messages').append(`<div class="alert alert-dismissable alert-${type} show fade">${msg}<button class="close" data-dismiss="alert">&times;</button></div>`);
      }

      function uniq(items, sep=' ') {
        if (!(items instanceof Array))
          items = `${str}`.split(sep).filter((s) => {return s != ''});
        let set = new Set(items);
        let arr = [];
        set.forEach((val) => {arr.push(val)});
        return arr.join(sep);
      }

      function csn(num) {
        let [integer, decimal] = `${num}`.split('.', 2);
        let three = new RegExp(/(\d{3})$/);
        let parts = [];

        while (three.test(integer))
          integer = integer.replace(three, (match) => {parts.unshift(match); return ''});

        if (integer)
          parts.unshift(integer);

        integer = parts.join(',');

        return decimal ? `${integer}.${decimal}` : integer;
      }

      $(function() {
        $('#spacer-navbar').on('click', 'a', function(e) {
          e.preventDefault();

          if ($(e.target).hasClass('nav-link')) {
            $('#messages').empty();
            $('#spacer-nav a').removeClass('active');
            $(e.target).addClass('active');
            open($(e.target).data('name'));
          }
        });

        // Set up swipe mechanics
        let mc = new Hammer(window);
        mc.get('swipe').set({direction: Hammer.DIRECTION_VERTICAL});
        mc.on('swipeleft swiperight panleft panright', function(e) {
          if (!e.isFinal || Math.abs(e.deltaX) < (window.innerWidth / 4))
            return;

          let name = (e.direction === Hammer.DIRECTION_LEFT)  ? $('#spacer-nav a.active').parent().next().find('a').data('name')
                   : (e.direction === Hammer.DIRECTION_RIGHT) ? $('#spacer-nav a.active').parent().prev().find('a').data('name')
                   : undefined;

          if (name !== undefined)
            open(name);
        });
      });

      const game = new Game;

    </script>
  </body>
</html>
