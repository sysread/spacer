<script type="text/javascript">

$(function() {
  let row = (dt, dd) => {
    return `<div class="row p-1"><div class="col-sm font-weight-bold">${dt}</div><div class="col-sm">${dd}</div></div>`;
  };

  Object.keys(data.shipclass).forEach((sc) => {
    let info = data.shipclass[sc];
    let ship = new Ship({shipclass: sc, fuel: info.tank});

    let deltav = Math.round(ship.current_acceleration() * 100) / 100;
    let burn_time = ship.max_burn_time(deltav, true) * data.hours_per_turn;
    let maxg_range = Physics.AU(Physics.range(burn_time * 3600, 0, deltav));

    let nominal_dv = Math.round(Math.min(0.8, deltav * 0.6) * 100) / 100;
    let nominal_burn_time = ship.max_burn_time(nominal_dv, true) * data.hours_per_turn;
    let nominal_range = Physics.AU(Physics.range(nominal_burn_time * 3600, 0, 1));

    let price = ship.price();
    price = Math.ceil(price + (price * game.place().sales_tax));

    if      (info.drive === 'ion')    price += 500    + (info.drives * 30);
    else if (info.drive === 'fusion') price += 100000 + (info.drives * 5000);

    let card  = $('<div class="card m-3">');
    let btn   = $('<button type="button" class="btn btn-dark btn-sm float-right">Trade in</button>');
    let hdr   = $('<h5 class="card-header text-capitalize">').append(sc).append(btn);
    let body  = $('<div class="card-body">');
    let rows  = $('<div class="card-text p-1">');

    rows.append(row('Price', csn(price)));

    rows.append(row(`Range (${deltav.toFixed(2)} G max)`,`${maxg_range.toFixed(2)} AU / ${csn(burn_time)} hr`));
    rows.append(row(`Range (${nominal_dv.toFixed(2)} G cruise)`, `${nominal_range.toFixed(2)} AU / ${csn(nominal_burn_time)} hr`));

    rows.append(row('Drive', `${info.drives} ${ship.drive.name}`));
    rows.append(row('Maximum thrust', `${csn(ship.thrust)} kN`));
    rows.append(row('Fuel tanks', info.tank));
    rows.append(row('Hull mass', `${csn(ship.shipclass.mass)} tonnes`));
    rows.append(row('Drive mass', `${csn(ship.drive_mass)} tonnes`));
    rows.append(row('Total mass (fueled)', `${csn(ship.current_mass())} tonnes`));

    rows.append(row('Cargo', info.cargo));
    rows.append(row('Hull', info.hull));
    rows.append(row('Armor', info.armor));
    rows.append(row('Hard points', info.hardpoints));

    card.append(hdr).append(body.append(rows));

    $('#ships').append(card);
  });
});

</script>

<div id="ships" class="container p-0 m-0"></div>
