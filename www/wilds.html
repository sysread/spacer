<script type="text/javascript">

$(function() {
  let hours = new Slider({
    min      : 0,
    max      : 96,
    step     : 4,
    initial  : 48,
    callback : (n) => {$('#harvest-hours').val(n)}
  });

  $('#harvest-hours-chooser').empty().append(hours.group);
  $('#harvest-dialog').on('show.bs.modal', () => {hours.reset()});

  let chooser;

  $('#collect-dialog').on('show.bs.modal', () => {
    let hrs     = hours.val;
    let turns   = hrs / 4;
    let harvest = game.place().harvest(turns);

    chooser = new ResourceExchange({
      store      : harvest,
      cargo      : game.player.ship.cargo,
      max_cargo  : game.player.ship.shipclass.cargo,
      minmaxbtns : true
    });

    $('#collect-explain').text(`After ${hrs} hours of work, your crew collected:`);
    $('#collect-results').empty().append(chooser.table);

    game.turn(turns);
  });

  $('#collect-complete').on('click', () => {
    game.player.ship.cargo = chooser.cargo;
    game.refresh();
    game.save_game();
  });
});

</script>

<div class="card p-3">
  <h3 class="card-header">Natural Resources</h3>
  <div class="card-body">
    <div class="card-text pb-3">
      <p>
        Harvesting natural resources takes time and hard work, but is a great way
        to make some extra money while starting out or when bad luck hits.
      </p>
      <button type="button" class="btn btn-dark btn-block btn-sm card-link" data-toggle="modal" data-target="#harvest-dialog">Harvest</button>
    </div>
  </div>
</div>

<div class="modal" id="harvest-dialog" data-backdrop="static">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Harvest natural resources</h5></div>
      <div class="modal-body">
        <div class="form-group">
          <label for="harvest-hours">How many hours will you commit to harvesting natural resources?</label>
          <input type="number" id="harvest-hours" name="harvest-hours" class="form-control">
        </div>
        <div id="harvest-hours-chooser"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-dark" id="harvest-complete" data-dismiss="modal" data-toggle="modal" data-target="#collect-dialog">Harvest</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="collect-dialog" data-backdrop="static">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Harvest results</h5></div>
      <div class="modal-body">
        <p id="collect-explain"></p>
        <div id="collect-results"></div>
      </div>
      <div class="modal-footer">
        <button type="button" id="collect-complete" class="btn btn-dark" data-dismiss="modal">Load</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Leave</button>
      </div>
    </div>
  </div>
</div>
