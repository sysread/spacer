<script type="text/javascript">

$(function() {
  for (let body in data.bodies)
    $('#home').append(`<option value="${body}">${system.name(body)}</option>`);

  $('#home').change((e) => {
    let home = $('#home').val();
    $('#home-info').html($('#' + home).html());
    $('#home-grav').text(data.bodies[home].gravity);
    $('#home-deltav').text(data.bodies[home].gravity * 2);

    let faction = data.bodies[home].faction;
    $('#faction').val(data.factions[faction].full_name);
    $('#faction-info').html($('#' + faction).html());
  });

  $('#home').val('mars');
  $('#home').change();

  $('#starting-game').on('shown.bs.modal', (e) => {
    $('#spacer-nav').data('in-transit', true);
    $('#starting-game-progress').css('width', '0%');

    let place   = $('#home').val();
    let faction = data.bodies[place].faction;
    let ship    = data.factions[faction].ship;

    let me = new Person({
      name    : $('#name').val(),
      home    : place,
      faction : faction,
      money   : 1000,
      ship    : new Ship({
        shipclass : ship,
        fuel      : data.shipclass[ship].tank
      })
    });

    me.ship.fuel = data.shipclass[ship].tank;
    game.new_game(me, place);

    let turns = data.initial_turns;
    let step  = Math.ceil(turns/10);
    let done  = 0;
    let timer;

    let interval = function() {
      if (done < turns) {
        let count = Math.min(turns - done, step);
        let pct = Math.ceil((done / turns) * 100);
        done += count;
        game.turn(count);
        $('#starting-game-progress').text(`${pct}%`).css('width', `${pct}%`);
        timer = window.setTimeout(interval, 200);
      }
      else {
        $('#starting-game-progress').css('width', '100%').text('Done!');
        game.refresh();
        $('#starting-game').modal('hide');
        $('#spacer-nav').data('in-transit', false);
        window.setTimeout(() => {open('summary')}, 100);
      }
    };

    timer = window.setTimeout(interval, 50);
  });
});

</script>

<div class="card p-3 mb-4">
  <h3 class="card-header">
    New Game
    <span class="float-right">
      <button id="start-game" type="button" class="btn btn-dark" data-toggle="modal" data-target="#starting-game">Start game</button>
    </span>
  </h3>
  <div class="card-body">
    <form>
      <label for="name">Captain name</label>
      <input class="form-control" type="text" name="name" id="name" value="Marco Solo">
      <br>

      <label for="home">Home</label>
      <select class="form-control text-capitalize" name="home" id="home"></select>
      <div class="form-text text-muted" id="home-info"></div>
      <div class="form-text text-muted">
        As a native growing up under <span id="home-grav"></span>G of
        gravity, your physiology can tolerate a maximum sustained acceleration
        of <span id="home-deltav"></span>G.
      </div>
      <br>

      <label for="faction">Faction</label>
      <input class="form-control" type="text" name="faction" id="faction" readonly>
      <div class="form-text text-muted" id="faction-info"></div>
      <br>
    </form>
  </div>
</div>

<div class="modal" id="starting-game" data-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Starting game</h5>
      </div>
      <div class="modal-body">
        <div class="progress bg-dark">
          <div id="starting-game-progress" class="progress-bar bg-warning" style="height: 35px; width: 0%">0%</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div hidden id="mercury">
  <p>
    Too close to the sun to permit domed habitations, Mercury's single city,
    Quicksilver, lies deep underground, providing it with a modicum of
    protection against the intense solar radiation bathing the surface.
  </p>
  <p>
    Known for its rich mineral deposits and hard-nosed populace, the knowledge
    gained during the process of excavating and settling Mercury was a major
    factor in the success of later colonies. Although nominally a member of the
    UN, Mercury is widely known to be effectively run by the unions, who work
    to ensure that Mercury is not unfairly exploited by Earth. <i>Nobody</i>
    messes with the local 127.
  </p>
</div>

<div hidden id="earth">
  <p>
    Under the unified governance of the UN, Earth has been at peace for
    decades. As the sole habital body in the system, Earth remains the largest
    population, economy, and military force in the system.
  </p>
</div>

<div hidden id="moon">
  <p>
    A natural target for the first extension of humanity into space, the Moon's
    domed cities and vast, subterranean passages hold the second largest
    population in the system as well as some of its best shipyards.
  </p>
  <p>
    With its lower gravity, excellent amenities, and close proximity to Earth,
    Luna hosts the official embassies of both the Martian Commonwealth and
    TRANSA.
  </p>
</div>

<div hidden id="mars">
  <p>
    Rising from the ashes of the Earth fleet's systemic bombardment during the
    war for independence, the Martian capitol of Barsoom is home to the most
    widely respected universities and scientific institutions in the system.
  </p>
  <p>
    The memories of those scars still fresh, Mars continues to sink a sizable
    proportion of its resources into its fleet and planetary defenses. Although
    smaller than the UN fleet, the Martian navy's vessels are newer and have a
    small but not inconsiderable tech advantage on Earth's aging ships.
  </p>
</div>

<div hidden id="phobos">
  <p>
    More akin to a captured asteroid than a moon, Phobos was hollowed out, its
    spin increased, and made home to the largest research facility in the solar
    system.
  </p>
</div>

<div hidden id="deimos">
  <p>
    Home to the Martian Commonwealth Navy, Deimos Command Station is well
    defended and hosts the primary Martian naval shipyard and officer's
    academy.
  </p>
</div>

<div hidden id="ceres">
  <p>
    Large enough to be given a spin gravity of nearly 0.5G, the hollowed out
    planetoid Ceres is a major shipping and commercial hub between the inner
    and outer planets.
  </p>
</div>

<div hidden id="europa">
  <p>
    One of the two Jovian moons claimed by Mars during the war, Europa is the
    source of much mineral wealth to the Commonwealth and is patrolled by the
    Martian fleet.
  </p>
</div>

<div hidden id="callisto">
  <p>
    Callisto's vast domed farms produce tons of food that are shipped across
    the system, supporting many of the outer colonies that cannot produce
    enough food to be self sufficient. It also hosts the regional Martian
    command orbital and dock yards.
  </p>
</div>

<div hidden id="ganymede">
  <p>
    The official headquarters of the SCS, Ganymede also hosts excellent
    agricultural facilities and shipyards, making it a commercial hub of the
    outer system.
  </p>
</div>

<div hidden id="enceladus">
  <p>
    The supply station orbiting Enceladus boasts the best views in the system
    and is the nexus for the harvesting and shipping of water from Saturn's
    rings.
  </p>
</div>

<div hidden id="rhea">
  <p>
    The Rhea Orbital Lab is the primary research and development platform of
    the SCS and maintains a small population serving the needs of the research
    community there.
  </p>
</div>

<div hidden id="titan">
  <p>
    With an actual atmosphere, albeit a poisonous one, Titan is home to
    TRANSA's largest and most prosperous settlement. Nestled in close proximity
    to two SCS orbitals around Saturn, Titan has become something  of a trade
    hub between the two factions.
  </p>
</div>

<div hidden id="triton">
  <p>
    In retrograde orbit of Neptune, the Triton orbital hosts the meager
    Plutonian Naval Command and acts as their primary supply station.
  </p>
</div>

<div hidden id="titania">
  <p>
    Rich in heavy organic compounds, Titania is the primary source of raw
    materials and shipping for TRANSA. With nearly a third of Earth's gravity
    and supported by a growing commercial mining industry, it is also one of
    the few TRANSA properties with a growing population.
  </p>
</div>

<div hidden id="pluto">
  <p>
    The furthest outpost of humanity, Pluto 
  </p>
</div>

<div hidden id="UN">
  <p>
    After the outbreak of hostilities with Mars more than 80 years ago and the
    treaties that followed, the UN assumed the role of the unified sovereign
    government over the Earth, Moon, and Mercury. Known for its glacial
    bureaucracy and stodgy leaders, Earth remains an economic powerhouse,
    largly as a result of remaining the sole inhabitable body in the system.
  </p>
  <p>
    Despite the fragile treaty after the War of Martian Independence, the UN
    member nations continue to see Mars as selfish and ungrateful.
  </p>
</div>

<div hidden id="MC">
  <p>
    Nearly 50 years after its founding as a science outpost in the early 22nd
    century, Mars declared independence from an Earth that it increasingly
    viewed as a distant, intrusive micromanager. In the 84 years since its
    founding, Mars has grown into a military power rivaling Earth, with a
    thriving economy and highly educated populace. Since its independence, Mars
    has focused its significant resources toward the scientific and
    technological achievements necessary to realize its population's dream of a
    "Green Mars".
  </p>
  <p>
    The Martian Commonwealth controls Mars and its moons as well as several of
    the Jovian moons, providing the infrastructure and resource to maintain and
    grow their subterranean and domed habitats, whose proximity to the radiant
    gas giant make them the bread basket of the outer planets.
  </p>
</div>

<div hidden id="TRANSA">
  <p>
    Those who live in the outer planets are exquisitely aware of the fragile
    existence they lead, completely dependent on shipments of food, water,
    medicine, and technology in order to survive.
  </p>
  <p>
    When Mars broke from Earth, deliveries to the furthest installations in the
    outer system ceased in the face of privateering and the realities of a war
    economy. Those who survived the food riots shortly found themselves under
    the magnetic boot of a coalition of gangs collectively calling themselves
    the Trans-Neptunian Authority.
  </p>
  <p>
    With resources stretched and hungry mouths to feed, TRANSA offers the
    lowest tax rate in the system, promising a hefty margin to any traders
    willing to make the "Long Haul", as it is popularly known. Given the size
    of TRANSA's tiny fleet and the vast volume of space it patrols, the Long
    Haul can as be perilous as it is profitable.
  </p>
</div>

<div hidden id="CC">
  <p>
    Holding a favorable position orbiting within the asteroid belt, the
    independent planetoid Ceres has long served as a trade hub between the
    inner and outer planets. Its location also serves to make it a launching
    point for mining operations within the asteroid belt.
  </p>
  <p>
    A number of shipyards have grown up around Ceres, taking advantage of the
    central location and ease of access to materials to make Ceres the primary
    ship-bulding center in the system.
  </p>
</div>

<div hidden id="SCS">
  <p>
    Faced with the same economic constraints and pressures as the outer planets
    during the war but with much closer and more powerful corporate interests
    at hand, the Saturnian moons controlling interests joined to form the Solar
    Commercial Syndicate. Funded by some of the richest corporations on Earth,
    the SCS has become a force unto itself, patrolling the outer planets' trade
    routes with its corporate fleet.
  </p>
  <p>
    Life in the domes of Saturn is difficult, and the harvesting of ice and ore
    in the outer system is dangerous work, but citizen employees can rest
    assured that the Board of Directors has their best interests at heart, or
    at least their compound interest at heart, as many are bound by contract or
    debt to their Syndicate.
  </p>
</div>
